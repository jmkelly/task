@using TaskItem = Task.Core.TaskItem
@model IEnumerable<TaskItem>

<div class="kanban-board board-grid">
    <div class="kanban-column board-column" data-status="todo" ondragover="event.preventDefault()" ondrop="handleDrop(event)">
        <div class="column-header">
            <h2>Todo</h2>
        </div>
        <div class="column-body task-list" ondragover="event.preventDefault()" ondrop="handleDrop(event)">
            @if (Model.Where(t => t.Status == "todo").Any())
            {
                @foreach (var task in Model.Where(t => t.Status == "todo"))
                {
                    <div class="task-card card" draggable="true" data-uid="@task.Uid" ondragstart="handleDragStart(event)">
                        <div class="task-header card-header">
                            <h3 class="task-title">@task.Title</h3>
                            <div class="task-meta">
                                <span class="task-priority priority-@task.Priority.ToLower()">@task.Priority</span>
                            </div>
                        </div>
                        <div class="card-body">
                        @if (!string.IsNullOrEmpty(task.Project) || !string.IsNullOrEmpty(task.Assignee))
                        {
                            <div class="task-context">
                                @if (!string.IsNullOrEmpty(task.Project))
                                {
                                    <div class="task-project">
                                        <span class="context-icon"><span class="emoji">üìÅ</span></span>
                                        <span class="context-text">@task.Project</span>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(task.Assignee))
                                {
                                    <div class="task-assignee">
                                        <span class="context-icon"><span class="emoji">üë§</span></span>
                                        <span class="context-text">@task.Assignee</span>
                                    </div>
                                }
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(task.Description))
                        {
                            <p class="task-description">@task.Description</p>
                        }
                        @if (task.Tags.Any())
                        {
                            <div class="task-tags">
                                @foreach (var tag in task.Tags)
                                {
                                    <span class="tag">@tag</span>
                                }
                            </div>
                        }
                        @if (task.DueDate.HasValue)
                        {
                            <div class="task-due-date">
                                Due: @task.DueDate.Value.ToString("MMM dd, yyyy")
                            </div>
                        }
                        </div>
                        <div class="task-actions card-footer">
                            <button class="btn-small" hx-get="/Index?handler=EditModal&uid=@task.Uid" hx-target="body" hx-swap="beforeend">
                                <span class="emoji emoji-leading">‚úèÔ∏è</span>Edit
                            </button>
                            <button class="btn-small" hx-post="/Index?handler=DeleteTask" hx-vals='{"uid": "@task.Uid"}' hx-target="#board" hx-swap="innerHTML" onclick="return confirm('Delete this task?')">
                                <span class="emoji emoji-leading">üóëÔ∏è</span>Delete
                            </button>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-icon"><span class="emoji">üìù</span></div>
                    <p>No tasks to do yet</p>
                    <small>Drag tasks here to get started</small>
                </div>
            }
        </div>
    </div>

    <div class="kanban-column board-column" data-status="in_progress" ondragover="event.preventDefault()" ondrop="handleDrop(event)">
        <div class="column-header">
            <h2>In Progress</h2>
        </div>
        <div class="column-body task-list" ondragover="event.preventDefault()" ondrop="handleDrop(event)">
            @if (Model.Where(t => t.Status == "in_progress").Any())
            {
                @foreach (var task in Model.Where(t => t.Status == "in_progress"))
                {
                    <div class="task-card card" draggable="true" data-uid="@task.Uid" ondragstart="handleDragStart(event)">
                        <div class="task-header card-header">
                            <h3 class="task-title">@task.Title</h3>
                            <div class="task-meta">
                                <span class="task-priority priority-@task.Priority.ToLower()">@task.Priority</span>
                            </div>
                        </div>
                        <div class="card-body">
                        @if (!string.IsNullOrEmpty(task.Project) || !string.IsNullOrEmpty(task.Assignee))
                        {
                            <div class="task-context">
                                @if (!string.IsNullOrEmpty(task.Project))
                                {
                                    <div class="task-project">
                                        <span class="context-icon"><span class="emoji">üìÅ</span></span>
                                        <span class="context-text">@task.Project</span>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(task.Assignee))
                                {
                                    <div class="task-assignee">
                                        <span class="context-icon"><span class="emoji">üë§</span></span>
                                        <span class="context-text">@task.Assignee</span>
                                    </div>
                                }
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(task.Description))
                        {
                            <p class="task-description">@task.Description</p>
                        }
                        @if (task.Tags.Any())
                        {
                            <div class="task-tags">
                                @foreach (var tag in task.Tags)
                                {
                                    <span class="tag">@tag</span>
                                }
                            </div>
                        }
                        @if (task.DueDate.HasValue)
                        {
                            <div class="task-due-date">
                                Due: @task.DueDate.Value.ToString("MMM dd, yyyy")
                            </div>
                        }
                        </div>
                        <div class="task-actions card-footer">
                            <button class="btn-small" hx-get="/Index?handler=EditModal&uid=@task.Uid" hx-target="body" hx-swap="beforeend">
                                <span class="emoji emoji-leading">‚úèÔ∏è</span>Edit
                            </button>
                            <button class="btn-small" hx-post="/Index?handler=DeleteTask" hx-vals='{"uid": "@task.Uid"}' hx-target="#board" hx-swap="innerHTML" onclick="return confirm('Delete this task?')">
                                <span class="emoji emoji-leading">üóëÔ∏è</span>Delete
                            </button>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-icon"><span class="emoji">‚ö°</span></div>
                    <p>Ready for work?</p>
                    <small>Move tasks here when you start them</small>
                </div>
            }
        </div>
    </div>

    <div class="kanban-column board-column" data-status="done" ondragover="event.preventDefault()" ondrop="handleDrop(event)">
        <div class="column-header">
            <h2>Done</h2>
        </div>
        <div class="column-body task-list" ondragover="event.preventDefault()" ondrop="handleDrop(event)">
            @if (Model.Where(t => t.Status == "done").Any())
            {
                @foreach (var task in Model.Where(t => t.Status == "done"))
                {
                    <div class="task-card card" draggable="true" data-uid="@task.Uid" ondragstart="handleDragStart(event)">
                        <div class="task-header card-header">
                            <h3 class="task-title">@task.Title</h3>
                            <div class="task-meta">
                                <span class="task-priority priority-@task.Priority.ToLower()">@task.Priority</span>
                            </div>
                        </div>
                        <div class="card-body">
                        @if (!string.IsNullOrEmpty(task.Project) || !string.IsNullOrEmpty(task.Assignee))
                        {
                            <div class="task-context">
                                @if (!string.IsNullOrEmpty(task.Project))
                                {
                                    <div class="task-project">
                                        <span class="context-icon"><span class="emoji">üìÅ</span></span>
                                        <span class="context-text">@task.Project</span>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(task.Assignee))
                                {
                                    <div class="task-assignee">
                                        <span class="context-icon"><span class="emoji">üë§</span></span>
                                        <span class="context-text">@task.Assignee</span>
                                    </div>
                                }
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(task.Description))
                        {
                            <p class="task-description">@task.Description</p>
                        }
                        @if (task.Tags.Any())
                        {
                            <div class="task-tags">
                                @foreach (var tag in task.Tags)
                                {
                                    <span class="tag">@tag</span>
                                }
                            </div>
                        }
                        @if (task.DueDate.HasValue)
                        {
                            <div class="task-due-date">
                                Due: @task.DueDate.Value.ToString("MMM dd, yyyy")
                            </div>
                        }
                        </div>
                        <div class="task-actions card-footer">
                            <button class="btn-small" hx-get="/Index?handler=EditModal&uid=@task.Uid" hx-target="body" hx-swap="beforeend">
                                <span class="emoji emoji-leading">‚úèÔ∏è</span>Edit
                            </button>
                            <button class="btn-small" hx-post="/Index?handler=DeleteTask" hx-vals='{"uid": "@task.Uid"}' hx-target="#board" hx-swap="innerHTML" onclick="return confirm('Delete this task?')">
                                <span class="emoji emoji-leading">üóëÔ∏è</span>Delete
                            </button>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-icon"><span class="emoji">üéâ</span></div>
                    <p>All caught up!</p>
                    <small>Completed tasks will appear here</small>
                </div>
            }
        </div>
    </div>
</div>
